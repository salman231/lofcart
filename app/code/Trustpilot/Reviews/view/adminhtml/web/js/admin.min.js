function receiveSettings(e){if(e.origin===location.origin)return receiveInternalData(e);const t=document.getElementById("configuration_iframe").dataset;if(e.origin!==t.transfer)return;const s=e.data;if("string"==typeof s)if(s.startsWith("sync:")||s.startsWith("showPastOrdersInitial:")){const e=s.split(":"),t={action:"handle_past_orders"};t[e[0]]=e[1],this.submitPastOrdersCommand(t)}else if(s.startsWith("resync")){const e={action:"handle_past_orders",resync:"resync"};this.submitPastOrdersCommand(e)}else if(s.startsWith("issynced")){const e={action:"handle_past_orders",issynced:"issynced"};this.submitPastOrdersCommand(e)}else if(s.startsWith("check_product_skus")){const e=s.split(":"),t={action:"check_product_skus"};t.skuSelector=e[1],this.submitCheckProductSkusCommand(t)}else"signup_data"===s?this.sendSignupData():"update"===s?this.updateplugin():"reload"===s?this.reloadSettings():this.handleJSONMessage(s)}function handleJSONMessage(e){const t={};if(tryParseJson(e,t))if(t.TrustBoxPreviewMode)this.trustBoxPreviewMode(t);else if(t.window)this.updateIframeSize(t);else if("submit"===t.type)this.submitSettings(t);else if(t.trustbox){document.getElementById("trustbox_preview_frame").contentWindow.postMessage(JSON.stringify(t.trustbox),"*")}}function trustBoxPreviewMode(e){const t=document.getElementById("trustpilot-trustbox-preview");e.TrustBoxPreviewMode.enable?t.hidden=!1:t.hidden=!0}function receiveInternalData(e){const t=e.data,s={};t&&"string"==typeof t&&tryParseJson(t,s)&&(s&&"loadCategoryProductInfo"===s.type&&requestCategoryInfo(),"updatePageUrls"!==s.type&&"newTrustBox"!==s.type||this.submitSettings(s))}function requestCategoryInfo(){}function submitPastOrdersCommand(e){e.form_key=window.FORM_KEY,e.scope=scope,e.scopeId=scopeId;const t=new XMLHttpRequest;t.open("POST",`${ajaxUrl}?isAjax=true`,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4===t.readyState&&(t.status>=400?console.log(`callback error: ${t.response} ${t.status}`):sendPastOrdersInfo(t.response))},t.send(encodeSettings(e))}function submitCheckProductSkusCommand(e){e.form_key=window.FORM_KEY,e.scope=scope,e.scopeId=scopeId;const t=new XMLHttpRequest;t.open("POST",`${ajaxUrl}?isAjax=true`,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe");e.contentWindow.postMessage(t.response,e.dataset.transfer)}},t.send(encodeSettings(e))}function submitSettings(e){const t={action:"handle_save_changes",form_key:window.FORM_KEY,scope:scope,scopeId:scopeId};if("updatePageUrls"===e.type)t.pageUrls=encodeURIComponent(JSON.stringify(e.pageUrls));else if("newTrustBox"===e.type)t.customTrustBoxes=encodeURIComponent(JSON.stringify(e));else{t.settings=encodeURIComponent(JSON.stringify(e.settings));const s=document.getElementById("trustbox_preview_frame");s?s.dataset.settings=btoa(encodeURIComponent(JSON.stringify(e.settings))):console.log("trustbox_preview_frame is missing. Skipping...")}"undefined"!=typeof websiteId&&(t.website_id=websiteId),"undefined"!=typeof storeId&&(t.store_id=storeId);const s=new XMLHttpRequest;s.open("POST",`${ajaxUrl}?isAjax=true`),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(encodeSettings(t))}function encodeSettings(e){let t="";for(const s in e)t+=`${s}=${e[s]}&`;return t.substring(0,t.length-1)}function sendSettings(){const e=document.getElementById("configuration_iframe"),t=e.dataset,s=JSON.parse(atob(t.settings));if(s.trustbox||(s.trustbox={}),s.trustbox.pageUrls=JSON.parse(atob(t.pageUrls)),s.pluginVersion=t.pluginVersion,s.source=t.source,s.version=t.version,s.basis="plugin",s.productIdentificationOptions=JSON.parse(t.productIdentificationOptions),s.configurationScopeTree=JSON.parse(atob(t.configurationScopeTree)),s.pluginStatus=JSON.parse(atob(t.pluginStatus)),s.isFromMarketplace=t.isFromMarketplace,s.trustbox.trustboxes&&t.sku)for(trustbox of s.trustbox.trustboxes)trustbox.sku=t.sku;if(s.trustbox.trustboxes&&t.name)for(trustbox of s.trustbox.trustboxes)trustbox.name=t.name;e.contentWindow.postMessage(JSON.stringify(s),t.transfer)}function sendPastOrdersInfo(e){const t=document.getElementById("configuration_iframe"),s=t.dataset;void 0===e&&(e=s.pastOrders),t.contentWindow.postMessage(e,s.transfer)}function updateIframeSize(e){const t=document.getElementById("configuration_iframe");t&&(t.height=e.window.height+"px")}function sendSignupData(){const e={action:"get_signup_data",form_key:window.FORM_KEY,scope:scope,scopeId:scopeId},t=new XMLHttpRequest;t.open("POST",`${ajaxUrl}?isAjax=true`,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe");e.contentWindow.postMessage(t.response,e.dataset.transfer)}},t.send(encodeSettings(e))}function tryParseJson(e,t){try{t=Object.assign(t,JSON.parse(e))}catch(e){return!1}return!0}window.addEventListener("message",this.receiveSettings);
//# sourceMappingURL=admin.min.js.map
